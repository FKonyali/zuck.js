/* zuck.js - https://github.com/ramon82/zuck.js - MIT License */
!function(e){"use strict";var t,a,n=(t=window,(a=function(e,a){var n=document,i=this;"string"==typeof e&&(e=n.getElementById(e));var s=function(e){return n.querySelectorAll(e)[0]},r=function(e,t){return e&&e[t]||""},o=function(e,t){if(e)for(var a=e.length,n=0;n<a;n++)t(n,e[n])},l=function(e,t,a){var n=[t.toLowerCase(),"webkit"+t,"MS"+t,"o"+t];o(n,function(t,n){e[n]=a})},d=function(e,t,a){var n=[a.toLowerCase(),"webkit"+a,"MS"+a,"o"+a];o(n,function(a,n){e.addEventListener(n,t,!1)})},c=function(e,t){d(e,t,"AnimationEnd")},u=function(e,t){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)};var m=function(e,t){var a="RequestFullScreen",n="requestFullScreen";if(t)document.exitFullScreen?document.exitFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen();else try{e[n]?e[n]():e["ms"+a]?e["ms"+a]():e["moz"+a]?e["moz"+a]():e["webkit"+a]&&e["webkit"+a]()}catch(e){}},v=function(e,t,a,n){var i=t>0?1:-1,r=Math.abs(t)/s("#zuck-modal").offsetWidth*90*i;if(h("cubeEffect")){var o=0==r?"scale(0.95)":"scale(0.930,0.930)";if(l(s("#zuck-modal-content").style,"Transform",o),r<-90||r>90)return!1}var d=h("cubeEffect")?"rotateY("+r+"deg)":"translate3d("+t+"px, 0, 0)";e&&(l(e.style,"TransitionTimingFunction",n),l(e.style,"TransitionDuration",a+"ms"),l(e.style,"Transform",d))},f=function(e,t,a,n){var i=0,s=0;if(e){if(e.offsetParent)do{if(i+=e.offsetLeft,s+=e.offsetTop,e==n)break}while(e=e.offsetParent);t&&(s-=t),a&&(i-=a)}return[i,s]},p=function(e){e=1e3*Number(e);var t=new Date(e),a=t.getTime(),n=((new Date).getTime()-a)/1e3,i=h("language","time"),s=[[60," "+i.seconds,1],[120,"1 "+i.minute,""],[3600," "+i.minutes,60],[7200,"1 "+i.hour,""],[86400," "+i.hours,3600],[172800," "+i.yesterday,""],[604800," "+i.days,86400]],r=1;n<0&&(n=Math.abs(n),r=2);for(var o=0,l=void 0;l=s[o++];)if(n<l[0])return"string"==typeof l[2]?l[r]:Math.floor(n/l[2])+l[1];return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()},y=e.id,g={skin:"snapgram",avatars:!0,stories:[],backButton:!0,backNative:!1,previousTap:!0,autoFullScreen:!1,openEffect:!0,cubeEffect:!1,list:!1,localStorage:!0,callbacks:{onOpen:function(e,t){t()},onView:function(e){},onEnd:function(e,t){t()},onClose:function(e,t){t()},onNextItem:function(e,t,a){a()},onNavigateItem:function(e,t,a){a()}},language:{unmute:"Touch to unmute",keyboardTip:"Press space to see next",visitLink:"Visit link",time:{ago:"ago",hour:"hour ago",hours:"hours ago",minute:"minute ago",minutes:"minutes ago",fromnow:"from now",seconds:"seconds ago",yesterday:"yesterday",tomorrow:"tomorrow",days:"days ago"}}},h=function(e,t){var n=function(e){return void 0!==e};return t?n(a[e])&&n(a[e][t])?a[e][t]:g[e][t]:n(a[e])?a[e]:g[e]},k=new function(){var e,a,l=s("#zuck-modal");l||t.Zuck.hasModal||(t.Zuck.hasModal=!0,(l=n.createElement("div")).id="zuck-modal",h("cubeEffect")&&(l.className="with-cube"),l.innerHTML='<div id="zuck-modal-content"></div>',l.style.display="none",l.setAttribute("tabIndex","1"),l.onkeyup=function(e){var t=e.keyCode;27==t?k.close():13!=t&&32!=t||k.next()},h("openEffect")&&l.classList.add("with-effects"),a=function(){l.classList.contains("closed")&&(g.innerHTML="",l.style.display="none",l.classList.remove("closed"),l.classList.remove("animated"))},(e=l).transitionEndEvent||(e.transitionEndEvent=!0,d(e,a,"TransitionEnd")),n.body.appendChild(l));var g=s("#zuck-modal-content"),b=function(e){var t=s("#zuck-modal"),a="",n="",r="0",o=s("#zuck-modal-slider-"+y),l={previous:s("#zuck-modal .story-viewer.previous"),next:s("#zuck-modal .story-viewer.next"),viewing:s("#zuck-modal .story-viewer.viewing")};if(!l.previous&&!e||!l.next&&e)return!1;e?(a="next",n="previous"):(a="previous",n="next"),h("cubeEffect")?"previous"==a?r=t.slideWidth:"next"==a&&(r=-1*t.slideWidth):r=-1*(r=f(l[a]))[0],v(o,r,600,null),setTimeout(function(){if(""!=a&&l[a]&&""!=n){var e=l[a].getAttribute("data-story-id");i.internalData.currentStory=e;var t=s("#zuck-modal .story-viewer."+n);t&&t.parentNode.removeChild(t),l.viewing&&(l.viewing.classList.add("stopped"),l.viewing.classList.add(n),l.viewing.classList.remove("viewing")),l[a]&&(l[a].classList.remove("stopped"),l[a].classList.remove(a),l[a].classList.add("viewing"));var r=L(a);r&&z(r,a);var d=i.internalData.currentStory,u=s('#zuck-modal [data-story-id="'+d+'"]');if(u){var m=(u=u.querySelectorAll("[data-index].active"))[0].firstElementChild;i.data[d].currentItem=parseInt(u[0].getAttribute("data-index"),10),u[0].innerHTML='<b style="'+m.style.cssText+'"></b>',c(u[0].firstElementChild,function(){i.nextItem(!1)})}v(o,"0",0,null),u&&x([u[0],u[1]],!0),h("callbacks","onView")(i.internalData.currentStory)}},650)},z=function(e,t,a){s("#zuck-modal");var l=s("#zuck-modal-slider-"+y),d="",m="",v=r(e,"id"),f=n.createElement("div"),g=r(e,"currentItem")||0,b="";if(s('#zuck-modal .story-viewer[data-story-id="'+v+'"]'))return!1;f.className="slides",o(r(e,"items"),function(t,a){g>t&&(e.items[t].seen=!0,a.seen=!0);var n=r(a,"length"),i=r(a,"linkText"),s=!0===r(a,"seen")?"seen":"",o='data-index="'+t+'" data-item-id="'+r(a,"id")+'"';g===t&&(b=p(r(a,"time"))),m+="<span "+o+' class="'+(g===t?"active":"")+" "+s+'"><b style="animation-duration:'+(""===n?"3":n)+'s"></b></span>',d+='<div data-time="'+r(a,"time")+'" data-type="'+r(a,"type")+'"'+o+' class="item '+s+" "+(g===t?"active":"")+'">'+("video"===r(a,"type")?'<video class="media" muted webkit-playsinline playsinline preload="auto" src="'+r(a,"src")+'" '+r(a,"type")+'></video><b class="tip muted">'+h("language","unmute")+"</b>":'<img class="media" src="'+r(a,"src")+'" '+r(a,"type")+">")+(r(a,"link")?'<a class="tip link" href="'+r(a,"link")+'" rel="noopener" target="_blank">'+(""!=i&&i?i:h("language","visitLink"))+"</a>":"")+"</div>"}),f.innerHTML=d;var L=f.querySelector("video"),w=function(e){e.muted?E.classList.add("muted"):E.classList.remove("muted")};L&&(L.onwaiting=function(e){L.paused&&(E.classList.add("paused"),E.classList.add("loading"))},L.onplay=function(){w(L),E.classList.remove("stopped"),E.classList.remove("paused"),E.classList.remove("loading")},L.onready=L.onload=L.onplaying=L.oncanplay=function(){w(L),E.classList.remove("loading")},L.onvolumechange=function(){w(L)});var E=n.createElement("div");E.className="story-viewer muted "+t+" "+(a?"":"stopped")+" "+(h("backButton")?"with-back-button":""),E.setAttribute("data-story-id",v);var S='<div class="head"><div class="left">'+(h("backButton")?'<a class="back">&lsaquo;</a>':"")+'<u class="img" style="background-image:url('+r(e,"photo")+');"></u><div><strong>'+r(e,"name")+'</strong><span class="time">'+b+'</span></div></div><div class="right"><span class="time">'+b+'</span><span class="loading"></span><a class="close" tabIndex="2">&times;</a></div></div><div class="slides-pointers"><div>'+m+"</div></div>";E.innerHTML=S,o(E.querySelectorAll(".close, .back"),function(e,t){t.onclick=function(e){e.preventDefault(),k.close()}}),E.appendChild(f),"viewing"==t&&x(E.querySelectorAll('[data-index="'+g+'"].active'),!1),o(E.querySelectorAll(".slides-pointers [data-index] > b"),function(e,t){c(t,function(){i.nextItem(!1)})}),"previous"==t?u(l,E):l.appendChild(E)};return{show:function(e,a){var r=s("#zuck-modal");h("callbacks","onOpen")(e,function(){g.innerHTML='<div id="zuck-modal-slider-'+y+'" class="slider"></div>';var a,o,l,d,c,u,p,k,w,x,A,T,I=i.data[e],D=I.currentItem||0,N=s("#zuck-modal-slider-"+y);a=N,o=s("#zuck-modal"),d={},c=void 0,u=void 0,p=void 0,k=void 0,w=void 0,x=function(e){var t=s("#zuck-modal .viewing");if("A"==e.target.nodeName)return!0;e.preventDefault();var a=e.touches?e.touches[0]:e,n=f(s("#zuck-modal .story-viewer.viewing"));o.slideWidth=s("#zuck-modal .story-viewer").offsetWidth,d={x:n[0],y:n[1]};var i=a.pageX,r=a.pageY;c={x:i,y:r,time:Date.now()},u=void 0,p={},l.addEventListener("mousemove",A),l.addEventListener("mouseup",T),l.addEventListener("mouseleave",T),l.addEventListener("touchmove",A),l.addEventListener("touchend",T),t&&t.classList.add("paused"),E(),k=setTimeout(function(){t.classList.add("longPress")},600),w=setTimeout(function(){clearInterval(w),w=!1},250)},A=function(e){var t=e.touches?e.touches[0]:e,a=t.pageX,n=t.pageY;c&&(p={x:a-c.x,y:n-c.y},void 0===u&&(u=!!(u||Math.abs(p.x)<Math.abs(p.y))),!u&&c&&(e.preventDefault(),v(l,d.x+p.x,0,null)))},T=function e(a){var r=s("#zuck-modal .viewing"),m=c;if(p){n.querySelectorAll("#zuck-modal .story-viewer").length;var f=c?Date.now()-c.time:void 0,y=Number(f)<300&&Math.abs(p.x)>25||Math.abs(p.x)>o.slideWidth/3,g=p.x<0,L=s(g?"#zuck-modal .story-viewer.next":"#zuck-modal .story-viewer.previous");u||(!y||g&&!L||!g&&!L?v(l,d.x,300):b(g)),c=void 0,l.removeEventListener("mousemove",A),l.removeEventListener("mouseup",e),l.removeEventListener("mouseleave",e),l.removeEventListener("touchmove",A),l.removeEventListener("touchend",e)}var x=i.internalData.currentVideoElement;if(k&&clearInterval(k),r&&(r.classList.remove("longPress"),r.classList.remove("paused")),w){clearInterval(w),w=!1;var E=function(){m.x>t.screen.width/3||!h("previousTap")?i.navigateItem("next",a):i.navigateItem("previous",a)},z=s("#zuck-modal .viewing");if(!z||!x)return E(),!1;z.classList.contains("muted")?S(x,z):E()}},(l=a).addEventListener("touchstart",x),l.addEventListener("mousedown",x),i.internalData.currentStory=e,I.currentItem=D,h("backNative")&&(location.hash="#!"+y);var C=L("previous");C&&z(C,"previous"),z(I,"viewing",!0);var M=L("next");M&&z(M,"next"),h("autoFullScreen")&&r.classList.add("fullscreen");var q=function(){r.classList.contains("fullscreen")&&h("autoFullScreen")&&t.screen.width<=1024&&m(r),r.focus()};if(h("openEffect")){var F=s("#"+y+' [data-id="'+e+'"] .img'),W=f(F);r.style.marginLeft=W[0]+F.offsetWidth/2+"px",r.style.marginTop=W[1]+F.offsetHeight/2+"px",r.style.display="block",r.slideWidth=s("#zuck-modal .story-viewer").offsetWidth,setTimeout(function(){r.classList.add("animated")},10),setTimeout(function(){q()},300)}else r.style.display="block",r.slideWidth=s("#zuck-modal .story-viewer").offsetWidth,q();h("callbacks","onView")(e)})},next:function(e){s("#zuck-modal"),h("callbacks","onEnd")(i.internalData.currentStory,function(){var e=i.internalData.currentStory,t=s("#"+y+' [data-id="'+e+'"]');t&&(t.classList.add("seen"),i.data[e].seen=!0,i.internalData.seenItems[e]=!0,A("seenItems",i.internalData.seenItems),w()),s("#zuck-modal .story-viewer.next")?b(!0):k.close()})},close:function(){var e=s("#zuck-modal");h("callbacks","onClose")(i.internalData.currentStory,function(){h("backNative")&&(location.hash=""),m(e,!0),h("openEffect")?e.classList.add("closed"):(g.innerHTML="",e.style.display="none")})}}},b=function(e){var t=e.getAttribute("data-id"),a=!1;i.internalData.seenItems[t]&&(a=!0),a?e.classList.add("seen"):e.classList.remove("seen");try{i.data[t]={id:t,photo:e.getAttribute("data-photo"),name:e.firstElementChild.lastElementChild.firstChild.innerText,link:e.firstElementChild.getAttribute("href"),lastUpdated:e.getAttribute("data-last-updated"),seen:a,items:[]}}catch(e){i.data[t]={items:[]}}e.onclick=function(e){e.preventDefault(),k.show(t)}},L=function(e){var t=i.internalData.currentStory,a=e+"ElementSibling";if(t){var n=s("#"+y+' [data-id="'+t+'"]')[a];if(n){var r=n.getAttribute("data-id");return i.data[r]||!1}}return!1},w=function(){o(n.querySelectorAll("#"+y+" .story.seen"),function(e,t){var a=i.data[t.getAttribute("data-id")];t.parentNode.removeChild(t),i.add(a,!0)})},x=function(e,t){var a=e[1],n=e[0],s=n.parentNode.parentNode.parentNode;if(!a||!n)return!1;var r=i.internalData.currentVideoElement;if(r&&r.pause(),"video"==a.getAttribute("data-type")){var o=a.getElementsByTagName("video")[0];if(!o)return i.internalData.currentVideoElement=!1,!1;var d=function(){o.duration&&l(n.getElementsByTagName("b")[0].style,"AnimationDuration",o.duration+"s")};d(),o.addEventListener("loadedmetadata",d),i.internalData.currentVideoElement=o,o.currentTime=0,o.play(),t.target&&S(o,s)}else i.internalData.currentVideoElement=!1},E=function(){var e=i.internalData.currentVideoElement;if(e)try{e.pause()}catch(e){}},S=function(e,t){e.muted=!1,e.volume=1,e.removeAttribute("muted"),e.play(),e.paused&&(e.muted=!0,e.play()),t&&t.classList.remove("paused")},A=function(e,a){try{if(h("localStorage")){var n="zuck-"+y+"-"+e;t.localStorage[n]=JSON.stringify(a)}}catch(e){}};i.data={},i.internalData={},i.internalData.seenItems=function(e){if(h("localStorage")){var a="zuck-"+y+"-"+e;return!!t.localStorage[a]&&JSON.parse(t.localStorage[a])}return!1}("seenItems")||{},i.add=i.update=function(t,a){var l,d=r(t,"id"),c=s("#"+y+' [data-id="'+d+'"]'),m=r(t,"items"),v=!1;i.data[d]={},c?v=c:(v=n.createElement("div")).className="story",!1===t.seen&&(i.internalData.seenItems[d]=!1,A("seenItems",i.internalData.seenItems)),v.setAttribute("data-id",d),v.setAttribute("data-photo",r(t,"photo")),v.setAttribute("data-last-updated",r(t,"lastUpdated"));var f=!1;m[0]&&(f=m[0].preview||""),l='<a href="'+r(t,"link")+'"><span class="img"><u style="background-image:url('+(h("avatars")||!f||""==f?r(t,"photo"):f)+')"></u></span><span class="info"><strong>'+r(t,"name")+'</strong><span class="time">'+p(r(t,"lastUpdated"))+'</span></span></a><ul class="items"></ul>',v.innerHTML=l,b(v),c||(a?e.appendChild(v):u(e,v)),o(m,function(e,t){i.addItem(d,t,a)}),a||w()},i.next=function(){k.next()},i.remove=function(e){var t=s("#"+y+' > [data-id="'+e+'"]');t.parentNode.removeChild(t)},i.addItem=function(e,t,a){var l=s("#"+y+' > [data-id="'+e+'"]'),d=n.createElement("li");d.className=r(t,"seen")?"seen":"",d.setAttribute("data-id",r(t,"id")),d.innerHTML='<a href="'+r(t,"src")+'" data-link="'+r(t,"link")+'" data-linkText="'+r(t,"linkText")+'" data-time="'+r(t,"time")+'" data-type="'+r(t,"type")+'" data-length="'+r(t,"length")+'"><img src="'+r(t,"preview")+'"></a>';var c,m,v,f=l.querySelectorAll(".items")[0];a?f.appendChild(d):u(f,d),c=l.getAttribute("data-id"),m=n.querySelectorAll("#"+y+' [data-id="'+c+'"] .items > li'),v=[],o(m,function(e,t){var a=t.firstElementChild,n=a.firstElementChild;v.push({src:a.getAttribute("href"),length:a.getAttribute("data-length"),type:a.getAttribute("data-type"),time:a.getAttribute("data-time"),link:a.getAttribute("data-link"),linkText:a.getAttribute("data-linkText"),preview:n.getAttribute("src")})}),i.data[c].items=v},i.removeItem=function(t,a){var n=s("#"+y+' > [data-id="'+t+'"] [data-id="'+a+'"]');e.parentNode.removeChild(n)},i.navigateItem=i.nextItem=function(e,t){var a=i.internalData.currentStory,n=i.data[a].currentItem,r=s('#zuck-modal .story-viewer[data-story-id="'+a+'"]'),l="previous"==e?-1:1;if(!r||1==r.touchMove)return!1;var d=r.querySelectorAll('[data-index="'+n+'"]'),c=d[0],u=d[1],m=n+l,v=r.querySelectorAll('[data-index="'+m+'"]'),f=v[0],y=v[1];if(r&&f&&y){var g=h("callbacks","onNavigateItem");(g=h("callbacks",g?"onNavigateItem":"onNextItem"))(a,y.getAttribute("data-story-id"),function(){"previous"==e?(c.classList.remove("seen"),u.classList.remove("seen")):(c.classList.add("seen"),u.classList.add("seen")),c.classList.remove("active"),u.classList.remove("active"),f.classList.remove("seen"),f.classList.add("active"),y.classList.remove("seen"),y.classList.add("active"),o(r.querySelectorAll(".time"),function(e,t){t.innerText=p(y.getAttribute("data-time"))}),i.data[a].currentItem=i.data[a].currentItem+l,x(v,t)})}else r&&"previous"!=e&&k.next(t)};return function(){location.hash=="#!"+y&&(location.hash=""),s("#"+y+" .story")&&o(e.querySelectorAll(".story"),function(e,t){b(t)}),h("backNative")&&t.addEventListener("popstate",function(e){location.hash!="#!"+y&&(location.hash="")},!1),o(h("stories"),function(e,t){i.add(t,!0)}),w();var a=h("avatars")?"user-icon":"story-preview",n=h("list")?"list":"carousel";return e.className="stories "+a+" "+n+" "+(h("skin")+"").toLowerCase(),i}()}).buildItem=function(e,t,a,n,i,s,r,o,l){return{id:e,type:t,length:a,src:n,preview:i,link:s,linkText:r,seen:o,time:l}},t.ZuckitaDaGalera=t.Zuck=a,a);"function"==typeof define&&define.amd?define(function(){return n}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.ZuckJS=n):e.ZuckJS=n}(this);